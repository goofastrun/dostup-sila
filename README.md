# Система контроля доступа

## Архитектура системы

```mermaid
graph TD
    U[Пользователь] --> |1. HTTP/HTTPS запросы| N[Nginx]
    N --> |2. Статические файлы| F[Frontend Container]
    N --> |3. API запросы /api/*| B[Backend Container]
    B --> |4. Кэширование сессий| R[Redis Container]
    B --> |5. SQL запросы| DB[Database Container]
    F --> |6. Запросы к API| N
    R --> |7. Возврат данных сессии| B
    DB --> |8. Возврат данных| B
    B --> |9. Ответ API| N
    N --> |10. Ответ клиенту| U
    
    subgraph Containers
        N
        F[Frontend:<br/>React + Vite<br/>Порт 8080]
        B[Backend:<br/>Node.js + Express<br/>Порт 3000]
        R[Redis:<br/>Кэш + Сессии<br/>Порт 6379]
        DB[Database:<br/>PostgreSQL<br/>Порт 5432]
    end
    
    style U fill:#f9f,stroke:#333,stroke-width:2px
    style N fill:#85C1E9,stroke:#333,stroke-width:2px
    style F fill:#82E0AA,stroke:#333,stroke-width:2px
    style B fill:#F8C471,stroke:#333,stroke-width:2px
    style R fill:#F1948A,stroke:#333,stroke-width:2px
    style DB fill:#BB8FCE,stroke:#333,stroke-width:2px

    classDef container fill:#f5f5f5,stroke:#333,stroke-width:2px
    class N,F,B,R,DB container
```

### Описание взаимодействия контейнеров

1. **Пользователь → Nginx (HTTP/HTTPS запросы)**
   - Все запросы от пользователя проходят через Nginx
   - Включает запросы статических файлов и API-запросы
   - Nginx работает как обратный прокси и балансировщик нагрузки

2. **Nginx → Frontend (Статические файлы)**
   - Перенаправляет запросы к статическим файлам на Frontend контейнер
   - Обслуживает React приложение на порту 8080
   - Обрабатывает все запросы, не начинающиеся с /api

3. **Nginx → Backend (API запросы)**
   - Перенаправляет все API запросы (/api/*) на Backend контейнер
   - Backend работает на порту 3000
   - Обрабатывает аутентификацию, авторизацию и бизнес-логику

4. **Backend → Redis (Кэширование)**
   - Сохраняет сессии пользователей
   - Кэширует часто запрашиваемые данные
   - Ограничивает количество попыток входа
   - Порт 6379

5. **Backend → Database (SQL запросы)**
   - Сохраняет все постоянные данные
   - Выполняет SQL запросы к базе данных
   - PostgreSQL работает на порту 5432

6. **Frontend → Nginx (API запросы)**
   - Frontend отправляет API запросы через Nginx
   - Запросы включают авторизацию, получение данных и т.д.
   - Nginx проксирует эти запросы на Backend

7. **Redis → Backend (Возврат данных сессии)**
   - Возвращает информацию о сессиях
   - Предоставляет кэшированные данные
   - Проверяет ограничения запросов

8. **Database → Backend (Возврат данных)**
   - Возвращает результаты SQL запросов
   - Отправляет данные пользователей, постов и другую информацию
   - Обрабатывает транзакции

9. **Backend → Nginx (Ответ API)**
   - Отправляет обработанные данные обратно через Nginx
   - Включает результаты запросов к базе данных
   - Содержит статусы операций и сообщения об ошибках

10. **Nginx → Пользователь (Ответ клиенту)**
    - Возвращает финальный ответ пользователю
    - Может включать статические файлы или данные API
    - Обеспечивает единую точку взаимодействия с системой

### Примеры потоков данных

1. **Получение списка постов:**
   ```
   Пользователь → Nginx → Frontend → Nginx → Backend → Database → Backend → Nginx → Пользователь
   ```

2. **Авторизация пользователя:**
   ```
   Пользователь → Nginx → Backend → Redis (проверка сессии) → Database (проверка учетных данных) → Redis (создание сессии) → Backend → Nginx → Пользователь
   ```

3. **Загрузка статического контента:**
   ```
   Пользователь → Nginx → Frontend → Nginx → Пользователь
   ```