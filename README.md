<lov-code>
# Система контроля доступа

## Архитектура системы

```mermaid
graph TD
    U[Пользователь] --> |HTTP/HTTPS запросы| N[Nginx]
    N --> |Статические файлы| F[Frontend Container]
    N --> |API запросы /api/*| B[Backend Container]
    B --> |Кэширование сессий| R[Redis Container]
    B --> |SQL запросы| DB[PostgreSQL Container]
    F --> |Запросы к API| N
    R --> |Возврат данных сессии| B
    DB --> |Возврат данных| B
    B --> |Ответ API| N
    N --> |Ответ клиенту| U

    style U fill:#f9f,stroke:#333,stroke-width:2px
    style N fill:#85C1E9,stroke:#333,stroke-width:2px
    style F fill:#82E0AA,stroke:#333,stroke-width:2px
    style B fill:#F8C471,stroke:#333,stroke-width:2px
    style R fill:#F1948A,stroke:#333,stroke-width:2px
    style DB fill:#BB8FCE,stroke:#333,stroke-width:2px

    classDef blackText fill:#000,stroke:#fff,stroke-width:2px,color:#fff;
    class N,F,B,R,DB,U blackText

    linkStyle 0,1,2,3,4,5,6,7,8,9 fill:#000,stroke:#000,color:#fff
```

### Redis в системе

#### Почему Redis?

1. **Высокая производительность:**
   - Хранение данных в оперативной памяти
   - Время отклика < 1 миллисекунды
   - Способность обрабатывать миллионы операций в секунду

2. **Оптимальное решение для сессий:**
   - Автоматическое удаление устаревших сессий (TTL)
   - Атомарные операции для безопасной работы с данными
   - Минимальная нагрузка на основную базу данных

3. **Гибкие структуры данных:**
   - Строки: для простых значений
   - Хеши: для хранения объектов сессий
   - Списки: для очередей уведомлений
   - Множества: для уникальных значений
   - Упорядоченные множества: для рейтингов и сортировок

4. **Масштабируемость:**
   - Поддержка кластеризации
   - Репликация для отказоустойчивости
   - Разделение данных между узлами

#### Использование Redis в проекте

1. **Управление сессиями:**
   ```javascript
   // Пример сохранения сессии
   await redis.setEx(`session:${userId}`, 3600, sessionData);
   
   // Пример проверки сессии
   const session = await redis.get(`session:${userId}`);
   ```

2. **Ограничение попыток входа:**
   ```javascript
   // Увеличение счетчика попыток
   await redis.incr(`login_attempts:${email}`);
   
   // Установка времени блокировки
   await redis.expire(`login_attempts:${email}`, 300);
   ```

3. **Кэширование данных:**
   ```javascript
   // Кэширование результатов запроса
   await redis.setEx(`cache:${queryKey}`, 3600, JSON.stringify(data));
   
   // Получение кэшированных данных
   const cached = await redis.get(`cache:${queryKey}`);
   ```

#### Конфигурация Redis

1. **Основные настройки:**
   ```conf
   maxmemory 2gb
   maxmemory-policy allkeys-lru
   timeout 0
   tcp-keepalive 300
   ```

2. **Политики очистки памяти:**
   - `allkeys-lru`: удаление наименее используемых ключей
   - `volatile-lru`: удаление устаревших ключей
   - `allkeys-random`: случайное удаление
   - `volatile-ttl`: удаление с наименьшим TTL

3. **Безопасность:**
   - Отключение опасных команд
   - Установка сложного пароля
   - Ограничение доступа по IP

### Описание взаимодействия контейнеров

1. **Пользователь → Nginx (HTTP/HTTPS запросы)**
   - Все запросы от пользователя проходят через Nginx
   - Включает запросы статических файлов и API-запросы
   - Nginx работает как обратный прокси и балансировщик нагрузки

2. **Nginx → Frontend (Статические файлы)**
   - Перенаправляет запросы к статическим файлам на Frontend контейнер
   - Обслуживает React приложение на порту 8080
   - Обрабатывает все запросы, не начинающиеся с /api

3. **Nginx → Backend (API запросы)**
   - Перенаправляет все API запросы (/api/*) на Backend контейнер
   - Backend работает на порту 3000
   - Обрабатывает аутентификацию, авторизацию и бизнес-логику

4. **Backend → Redis (Кэширование)**
   - Сохраняет сессии пользователей
   - Кэширует часто запрашиваемые данные
   - Ограничивает количество попыток входа
   - Порт 6379

5. **Backend → Database (SQL запросы)**
   - Сохраняет все постоянные данные
   - Выполняет SQL запросы к базе данных
   - PostgreSQL работает на порту 5432

6. **Frontend → Nginx (API запросы)**
   - Frontend отправляет API запросы через Nginx
   - Запросы включают авторизацию, получение данных и т.д.
   - Nginx проксирует эти запросы на Backend

7. **Redis → Backend (Возврат данных сессии)**
   - Возвращает информацию о сессиях
   - Предоставляет кэшированные данные
   - Проверяет ограничения запросов

8. **Database → Backend (Возврат данных)**
   - Возвращает результаты SQL запросов
   - Отправляет данные пользователей, постов и другую информацию
   - Обрабатывает транзакции

9. **Backend → Nginx (Ответ API)**
   - Отправляет обработанные данные обратно через Nginx
   - Включает результаты запросов к базе данных
   - Содержит статусы операций и сообщения об ошибках

## Дополнительные функции
- Загрузка и хранение файлов
- Система уведомлений через toast-сообщения
- Адаптивный дизайн для всех страниц
- Навигационное меню с динамическим отображением пунктов в зависимости от роли

# Система контроля доступа

## Архитектура системы

### База данных (PostgreSQL)
- Хранит все данные системы в двух основных таблицах:
  1. `users` - информация о пользователях:
     - id (уникальный идентификатор)
     - email (почта пользователя)
     - password (пароль)
     - name (имя)
     - birth_date (дата рождения)
     - gender (пол)
     - role (роль в системе)
     - department (отдел)
  
  2. `posts` - записи и публикации:
     - id (уникальный идентификатор)
     - content (содержание записи)
     - department (отдел, к которому относится запись)
     - created_at (дата создания)
     - author_id (ID автора записи)
     - file_url (ссылка на прикрепленный файл)

### Бэкенд (Node.js + Express)
- Запускается в контейнере Backend на порту 3000
- Обрабатывает все запросы к базе данных
- Основные маршруты API:
  - `/api/login` - аутентификация пользователей
  - `/api/register` - регистрация новых пользователей
  - `/api/users` - управление пользователями
  - `/api/posts` - работа с записями
- Использует Redis для хранения сессий и ограничения попыток входа
- Сохраняет загруженные файлы в директорию uploads

### Фронтенд (React + Vite)
- Запускается в контейнере Frontend на порту 8080
- Использует React Query для кэширования и управления состоянием
- Основные страницы:
  - Вход (/login)
  - Регистрация (/register)
  - Главная страница (/)
  - Личный кабинет (/profile)
  - Управление пользователями (/users)
  - Управление ролями (/roles)

### Nginx (Прокси-сервер)
- Работает как обратный прокси
- Перенаправляет запросы:
  - На фронтенд для статических файлов и UI
  - На бэкенд для API-запросов (/api/*)
- Обеспечивает балансировку нагрузки

### Redis (Кэширование)
- Хранит временные данные:
  - Сессии пользователей
  - Счетчики попыток входа
  - Временные блокировки

## Взаимодействие компонентов

1. Пользователь открывает сайт
   - Nginx получает запрос
   - Перенаправляет на Frontend для отображения интерфейса

2. Пользователь выполняет вход
   - Frontend отправляет данные на `/api/login`
   - Nginx перенаправляет запрос на Backend
   - Backend проверяет данные в PostgreSQL
   - Redis отслеживает попытки входа

3. Работа с данными
   - Frontend отправляет запросы через API
   - Backend обрабатывает запросы
   - PostgreSQL хранит все постоянные данные
   - Redis кэширует часто используемые данные

## Развертывание

Система разворачивается через Docker Compose:
```bash
docker-compose up -d
```

Это запустит все необходимые контейнеры:
- Database (PostgreSQL)
- Backend (Node.js)
- Frontend (React)
- Redis
- Nginx

## Роли в системе

## Страницы системы

## Отделы

## Безопасность

## Дополнительные функции
```